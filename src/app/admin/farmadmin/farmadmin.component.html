<!-- Add Farm Toggle Button -->
<div class="text-center mt-20">
  <button
    (click)="creatingNew = !creatingNew"
    class="bg-blue-600 text-white px-3 py-1 rounded-lg hover:bg-blue-700 transition duration-300"
  >
    {{ creatingNew || editMode ? 'Close Form' : 'Add New Farm' }}
  </button>
</div>

<!-- Farm Form Card -->
<div
  *ngIf="creatingNew || editMode"
  class="max-w-md mx-auto mt-8 p-6 bg-white rounded-xl shadow-md transition-shadow hover:shadow-lg hover:scale-[1.01] duration-300"
>
  <h2 class="text-lg font-semibold mb-4 text-center">
    {{ editMode ? 'Edit Farm' : 'Add New Farm' }}
  </h2>

  <form (ngSubmit)="submitFarm()" #farmForm="ngForm">
    <!-- Title -->
    <div class="mb-4">
      <label class="block mb-1 text-sm font-medium">Title</label>
      <input
        type="text"
        class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-300 outline-none text-sm"
        [(ngModel)]="newFarm.title"
        name="title"
        required
      />
    </div>

    <!-- Image URL -->
    <div class="mb-4">
      <label class="block mb-1 text-sm font-medium">Image URL</label>
      <input
        type="url"
        class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-300 outline-none text-sm"
        [(ngModel)]="newFarm.imageUrl"
        name="imageUrl"
        required
      />
    </div>

    <!-- Practice Type -->
    <div class="mb-4">
      <label class="block mb-1 text-sm font-medium">Practice Type</label>
      <input
        type="text"
        class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-300 outline-none text-sm"
        [(ngModel)]="newFarm.practiceType"
        name="practiceType"
        required
      />
    </div>

    <!-- Description -->
    <div class="mb-4">
      <label class="block mb-1 text-sm font-medium">Description</label>
      <textarea
        class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-300 outline-none text-sm resize-none"
        rows="4"
        [(ngModel)]="newFarm.description"
        name="description"
        required
      ></textarea>
    </div>

    <!-- Buttons -->
    <div class="flex flex-col gap-2">
      <button
        type="submit"
        class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors duration-300 text-sm"
        [disabled]="farmForm.invalid || loading"
      >
        {{ editMode ? 'Update' : 'Create' }} Farm
      </button>

      <button
        type="button"
        class="w-full bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 transition-colors duration-300 text-sm"
        (click)="resetForm()"
      >
        Cancel
      </button>
    </div>
  </form>
</div>

<!-- Farm Cards -->
<div *ngIf="farms.length > 0; else noFarms" class="max-w-6xl mx-auto mt-10 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 px-4">
  <div
    *ngFor="let farm of farms"
    class="bg-white border rounded-lg shadow-md hover:shadow-xl transition-shadow duration-300 flex flex-col"
  >
    <div class="overflow-hidden rounded-t-lg">
      <img
        *ngIf="farm.imageUrl"
        [src]="farm.imageUrl"
        alt="Farm Image"
        class="w-full h-40 object-cover transform hover:scale-105 transition-transform duration-300"
      />
    </div>
    <div class="p-4 flex flex-col flex-grow text-sm">
      <h3 class="font-semibold text-lg mb-2">{{ farm.title }}</h3>
      <p class="mb-1 text-gray-700"><strong>Practice:</strong> {{ farm.practiceType }}</p>
      <p class="text-gray-600 flex-grow">{{ farm.description | slice:0:150 }}{{ farm.description.length > 150 ? '...' : '' }}</p>
      <div class="mt-4 flex justify-end space-x-3">
        <button
          class="px-4 py-1 bg-yellow-500 hover:bg-yellow-600 text-white rounded text-sm transition"
          (click)="editFarm(farm)"
        >
          Edit
        </button>
        <button
          class="px-4 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm transition"
          (click)="deleteFarm(farm._id!)"
        >
          Delete
        </button>
      </div>
    </div>
  </div>
</div>

<!-- No Farms Message -->
<ng-template #noFarms>
  <p class="text-center mt-8 text-gray-600 italic">No farms available. Click "Add New Farm" to create one.</p>
</ng-template>
